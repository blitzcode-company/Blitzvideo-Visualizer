<app-header></app-header>

<div class="video-container">
  <h2 class="tituloVideo">{{ video.titulo }}</h2>

  
  <video #videoPlayer class="reproductor" controls>
    <source [src]="video.link" type="video/mp4">
  </video>
  <div class="puntuar">
    <span>Puntuación: </span>
    <a (click)="puntuar(1)">1</a>
    <a (click)="puntuar(2)">2</a>
    <a (click)="puntuar(3)">3</a>
    <a (click)="puntuar(4)">4</a>
    <a (click)="puntuar(5)">5</a>
  </div>
  

  
 <div class="canalynombre">
  

    <img class="fotodeperfil" src="{{ video.canal.user.foto }}" alt="Logo del canal del usuario" srcset="">
    <p class="nombreCanal"> {{ video.canal.nombre }}</p>

    <div class="visitas">
      <p>{{ video.visitas_count }} visualizaciones</p>
    </div>
 </div>

  <div class="descripcion">
    <br>
    <br>
    <p class="fechadescripcion">Fecha de subida: {{ video.created_at}}</p>
    <p>Descripción:</p>
    <p>{{ video.descripcion }}</p>
  </div>
  
</div>


<div class="comentarios-container">
  <form (ngSubmit)="crearComentario()">
    <div class="comentarista">
      <div class="ashe">
        <div class="inputyenvio">
          <img *ngIf="status.isLoggedIn && usuario?.foto"[src]="usuario?.foto" class="fotoInput" alt="Foto del usuario">
          <img *ngIf="!status.isLoggedIn && !usuario?.foto" src="assets/images/user.png" class="fotoInput" alt="Foto del usuario">
          <input type="text" id="nuevoComentario" [(ngModel)]="nuevoComentario.mensaje" name="nuevoComentarioMensaje"
            placeholder="Escribe un comentario" required>
        </div>
        <button class="enviarComentario" type="submit">Enviar</button>
      </div>
    </div>
  </form>
  <hr>
  <div id="comentarios">
    <div *ngFor="let comentario of comentarios" class="comentario">
      <div class="comentado">
        <img *ngIf="comentario.user?.foto" [src]="comentario.user?.foto" class="fotocomentador"
          alt="Foto del comentador">
        <p>{{ comentario.user?.name }}</p>
      </div>

      <p>{{ comentario.mensaje }}</p>
      <button (click)="toggleResponder(comentario)" class="botonResponder" >Responder</button>
      <a (click)="toggleRespuestas(comentario)">
        {{ comentario.mostrarRespuestas ? 'Ocultar respuestas' : '' + (comentario.respuestas?.length || 0) + ' respuestas' }}
      </a>      
      <form *ngIf="selectedComentarioId === comentario.id" (ngSubmit)="enviarRespuesta()">
        <div>
          <input type="text" [(ngModel)]="respuestaComentario.mensaje" name="respuestaMensaje"
            required>
          <button type="submit">Enviar respuesta</button>
        </div>
      </form>

      <div *ngIf="comentario.mostrarRespuestas" class="respuestas">
        <div *ngIf="comentario.respuestas && comentario.respuestas.length > 0" class="respuestas-container">
          <div *ngFor="let respuesta of comentario.respuestas" class="respuesta">
          <div class="respondido">
            <img *ngIf="respuesta.user?.foto" [src]="respuesta.user?.foto" class="fotoRespuesta" alt="Foto del usuario que responde">
            <p>{{ respuesta.user?.name }}</p>
          </div>
            <p>{{ respuesta.mensaje }}</p>
            <button (click)="toggleResponder(respuesta)" class="botonResponder">Responder</button>
            <form *ngIf="selectedComentarioId === respuesta.id" (ngSubmit)="enviarRespuesta()">
              <div>
                <br>
                <input type="text" [(ngModel)]="respuestaComentario.mensaje" name="respuestaMensaje"
                  required>
                <button type="submit">Enviar respuesta</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>